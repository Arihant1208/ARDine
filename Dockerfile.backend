# Backend API server
FROM node:22-alpine

WORKDIR /app

# Install dependencies
COPY package.json package-lock.json ./
RUN npm ci --ignore-scripts

# Copy source code
COPY tsconfig.json ./
COPY backend/ backend/
COPY database/ database/
COPY src/shared/types.ts src/shared/types.ts

EXPOSE 4000

HEALTHCHECK --interval=30s --timeout=3s --start-period=10s --retries=3 \
    CMD wget -qO- http://localhost:4000/api/health || exit 1

CMD ["npx", "tsx", "backend/server.ts"]
